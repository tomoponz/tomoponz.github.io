<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>tomoponz｜黒歴史</title>
  <meta name="description" content="隠しページ：黒歴史ワープ">

  <link rel="stylesheet" href="style.css">
  <script defer src="app.js"></script>

  <!-- 重要：この順番で -->
  <script defer src="places.js"></script>
  <script defer src="portal.js"></script>

  <style>
    #fade{
      position:fixed; inset:0;
      background:#000;
      opacity:0;
      pointer-events:none;
      transition: opacity .45s ease;
      z-index:9999;
    }
    .fadeIn{ opacity:1 !important; }

    .imgPh{
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.03);
      color:rgba(234,241,255,.76);
      font-size:13px;
    }
    #imgBox img{
      width:100%;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      display:block;
    }
    #mapBox iframe{
      width:100%;
      height:320px;
      border:0;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.2);
    }
    pre.console{
      white-space:pre-wrap;
      word-break:break-word;
      margin:0;
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.22);
      color:rgba(234,241,255,.82);
      font-size:12px;
    }
  </style>
</head>

<body>
  <div id="fade" aria-hidden="true"></div>

  <!-- 統一メニュー -->
  <header class="nav">
    <a class="brand" href="index.html" aria-label="tomoponz ホーム">
      <span class="logo" aria-hidden="true"></span>
      <span class="brandText">
        <span class="brandName">tomoponz</span>
        <span class="brandSub" id="brandSub"></span>
      </span>
    </a>

    <nav class="navlinks" aria-label="メニュー">
      <a class="chip" href="index.html">プロフィール</a>
      <a class="chip" href="omikuji.html">おみくじ</a>
      <a class="chip" href="shindan.html">診断</a>
      <a class="chip" href="gallery.html">ネタ置き場</a>
      <a class="chip" href="links.html">リンク</a>
      <a class="chip" href="games.html">ゲーム</a>
      <a class="chip" href="door.html">ドア</a>
      <a class="chip" href="hachi.html">八百科事典</a>
      <a class="chip active" href="kuro.html">黒歴史</a>
    </nav>
  </header>

  <main class="wrap">
    <section class="hero">
      <h1 class="h1">黒歴史</h1>
      <p class="sub">コナミコマンドで来る前提の隠しページ。</p>

      <div class="btnrow">
        <button onclick="toggleFxSound()">効果音：<b id="fxSoundState">ON</b></button>
        <button onclick="toggleFxParticles()">粒子：<b id="fxParticlesState">ON</b></button>

        <button class="btn primary" onclick="kuroAgain()">黒歴史を引き直す</button>
        <a class="btn" href="door.html">ドアへ戻る</a>
        <a class="btn" href="warp.html">通常ワープへ</a>
      </div>

      <div class="note" style="margin-top:12px">
        ※ここは「kuro:true」の枠が存在しないと普通の場所に落ちます。<br>
        places.js に黒歴史枠（kuro:true + kuroText 等）を入れておけ。
      </div>
    </section>

    <section class="grid" style="margin-top:12px">
      <div class="card">
        <h2>到達先</h2>
        <div class="row" style="justify-content:space-between;align-items:flex-start;gap:14px">
          <div style="flex:1;min-width:240px">
            <div class="pill">TITLE</div>
            <h2 id="placeTitle" style="margin-top:8px;font-size:22px">読み込み中…</h2>

            <hr class="sep">
            <div class="pill">TEXT</div>
            <p id="placeDesc" class="muted" style="margin-top:8px">読み込み中…</p>

            <div class="btnrow">
              <a class="btn" id="wikiLink" href="#" target="_blank" rel="noopener">リンク</a>
              <a class="btn" id="mapLink" href="#" target="_blank" rel="noopener">地図</a>
            </div>
          </div>

          <div style="flex:1;min-width:240px">
            <div class="pill">IMAGE</div>
            <div id="imgBox" style="margin-top:8px">
              <div class="imgPh">画像なし</div>
            </div>

            <hr class="sep">
            <div class="pill">MAP</div>
            <div id="mapBox" style="margin-top:8px">
              <div class="imgPh">地図はここに出る</div>
            </div>
          </div>
        </div>

        <hr class="sep">
        <div class="pill">CONSOLE</div>
        <pre class="console" id="warpConsole">init…</pre>
      </div>

      <div class="card">
        <h2>ログ</h2>
        <ul class="list" id="warpLogList"></ul>
        <div class="btnrow">
          <button onclick="clearWarpLog()">ログ消去</button>
          <a class="btn" href="warp.html">通常ワープ
